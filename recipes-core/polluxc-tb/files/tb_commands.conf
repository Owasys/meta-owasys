#!/bin/sh

##### INTERVAL

TIME_INTERVAL=3600
SLEEP="/bin/sleep"

##### PLATFORM

PLATFORM='unknown'
MACHINE_TYPE=$(uname -m)
if [ "${MACHINE_TYPE}" = "armv5tejl" ]; then
  PLATFORM='owa3x'
elif [ "${MACHINE_TYPE}" = "armv7l" ]; then
  PLATFORM='owa4x'
elif [ "${MACHINE_TYPE}" = "x86_64" ]; then
  PLATFORM='x86_64'
fi

printf "Running on %s platform\n" $PLATFORM >&2

##### LOGGER

LOGGER="$(which logger)"
LOG_LABEL=$EXEC_NAME

##### PLATFORM-SPECIFIC VARIABLES

if [ ${PLATFORM} = 'owa3x' ]; then
  REDIS_CLI="/usr/bin/redis-cli"
  REDIS_SERVER="/usr/bin/redis-server"
  JQ="jq"
elif [ ${PLATFORM} = 'owa4x' ] || [ ${PLATFORM} = 'x86_64']; then
  REDIS_CLI="redis-cli"
  REDIS_SERVER="redis-server"
  JQ="/usr/bin/jq"
fi

##### REDIS

REDIS_CONF="/etc/pollux/redis.conf"
REDIS_PIDFILE="/var/run/redis.pid"
REDIS_INPUT_QUEUE="tb-rpc-in"
SOCK_PATH="/tmp/redis.sock"

##### TUNNEL

SSH_TUNNEL_WRAPPER="start_tunnel.sh"
SSH_TUNNEL_WRAPPER_PATH="/home/scripts/$SSH_TUNNEL_WRAPPER"
SSH_TUNNEL_CLIENT="dbclient"
SSH_TUNNEL_BEGIN="/bin/dbclient -f -N -y -i /root/.ssh/id_rsa -R "
SSH_TUNNEL_END=":localhost:22 -T owa3x@"
SSH_TUNNEL_HOST="owasys.com"
SSH_TUNNEL_PORT="5000"
REMOVE_BACKSLASH="sed 's/^.//;s/.$//' | sed 's/\\//g'"

##### REBOOT

REBOOT="/sbin/reboot" # -d"
PROCESSES="pollux redis dbus logd" #Posix does not support arrays
if [ ${PLATFORM} = "owa3x" ]; then
  KILL=/usr/bin/pkill
elif [ ${PLATFORM} = "owa4x" ]; then
  KILL=/usr/bin/killall
fi
#REBOOT_DELAY="/sbin/reboot -d"

##### UPDATE

UPDATE_FILE="/home/update/update"

##### DIAGNOSE

DIAGNOSE_FILE="/home/scripts/owa_info.sh"
BOOTSTRAP=1
